/* CRIAÇÃO DA ESTRUTURA DE TABELAS */

CREATE TABLE TB_UF (
    NM_UF CHAR(2) NOT NULL PRIMARY KEY,
    DS_UF VARCHAR(50) NOT NULL
);

CREATE TABLE TB_CIDADE (
    CD_CIDADE INTEGER NOT NULL PRIMARY KEY,
    NM_UF CHAR(2) NOT NULL REFERENCES TB_UF,
    DS_CIDADE VARCHAR(50) NOT NULL
);

CREATE TABLE TB_PESSOA (
    CD_PESSOA INTEGER NOT NULL PRIMARY KEY,
    DS_PESSOA VARCHAR(50) NOT NULL,
    IN_SITUACAO CHAR(1) NOT NULL,
    CHECK(IN_SITUACAO IN('A', 'I'))
);

CREATE TABLE TB_ENDERECO (
    CD_ENDERECO INTEGER NOT NULL,
    CD_PESSOA INTEGER NOT NULL REFERENCES TB_PESSOA,
    CD_CIDADE INTEGER NOT NULL REFERENCES TB_CIDADE,
    DS_BAIRRO VARCHAR(50) NOT NULL,
    DS_RUA VARCHAR(50) NOT NULL,
    PRIMARY KEY(CD_ENDERECO, CD_PESSOA)
);

CREATE TABLE TB_PAGAMENTO (
    CD_PAGAMENTO INTEGER NOT NULL PRIMARY KEY,
    DS_PAGAMENTO VARCHAR(50) NOT NULL,
    QT_PARCELA INTEGER NOT NULL,
    IN_ENTRADA CHAR(1) NOT NULL,
    CHECK(IN_ENTRADA IN('S', 'N'))
);

CREATE TABLE TB_PEDIDO (
    NR_PEDIDO INTEGER NOT NULL,
    CD_ENDERECO INTEGER NOT NULL,
    CD_PESSOA INTEGER NOT NULL,
    CD_PAGAMENTO INTEGER NOT NULL REFERENCES TB_PAGAMENTO,
    DT_PEDIDO DATE NOT NULL,
    VL_TOTAL NUMERIC(10,4) NOT NULL,
    PRIMARY KEY(NR_PEDIDO, CD_PESSOA, CD_ENDERECO),
    FOREIGN KEY(CD_ENDERECO, CD_PESSOA) REFERENCES TB_ENDERECO(CD_ENDERECO, CD_PESSOA)
);

CREATE TABLE TB_CONTAS (
    CD_CONTA INTEGER NOT NULL,
    NR_PEDIDO INTEGER NOT NULL,
    CD_PESSOA INTEGER NOT NULL,
    CD_ENDERECO INTEGER NOT NULL,
    NR_PARCELA INTEGER NOT NULL,
    VL_PARCELA NUMERIC(10,4) NOT NULL,
    PRIMARY KEY(CD_CONTA, NR_PEDIDO, CD_PESSOA, CD_ENDERECO),
    FOREIGN KEY(NR_PEDIDO, CD_ENDERECO, CD_PESSOA) REFERENCES TB_PEDIDO(NR_PEDIDO, CD_PESSOA, CD_ENDERECO)
);

CREATE TABLE TB_PRODUTO (
    CD_PRODUTO INTEGER NOT NULL PRIMARY KEY,
    DS_PRODUTO VARCHAR(50) NOT NULL,
    VL_PRODUTO NUMERIC(10,4) NOT NULL,
    QT_PROTUDO NUMERIC(10,4) NOT NULL
);

CREATE TABLE TB_PEDIDO_PRODUTO (
    NR_PEDIDO INTEGER NOT NULL,
    CD_ENDERECO INTEGER NOT NULL,
    CD_PESSOA INTEGER NOT NULL,
    CD_PRODUTO INTEGER NOT NULL REFERENCES TB_PRODUTO,
    QT_PRODUTO NUMERIC(10,4) NOT NULL,
    VL_PRODUTO NUMERIC(10,4) NOT NULL,
    PRIMARY KEY(NR_PEDIDO, CD_PESSOA, CD_ENDERECO, CD_PRODUTO),
    FOREIGN KEY(NR_PEDIDO, CD_PESSOA, CD_ENDERECO) REFERENCES TB_PEDIDO(NR_PEDIDO, CD_PESSOA, CD_ENDERECO)
);

/* INSERINDO DADOS NAS TABELAS */

INSERT INTO TB_PRODUTO VALUES(1, 'MOUSE OPTICO', 34, 4);
INSERT INTO TB_PRODUTO VALUES(2, 'TECLADO MULTIMIDIA', 28.68, 2);
INSERT INTO TB_PRODUTO VALUES(3, 'CAIXAS DE SOM', 50, 5);
INSERT INTO TB_PRODUTO VALUES(4, 'IMPRESSORA HP MULTIFUNCIONAL', 320, 1);
INSERT INTO TB_PRODUTO VALUES(5, 'PLACA DE REDE REALTEK', 44.50, 10);
INSERT INTO TB_PRODUTO VALUES(6, 'LEITORA/GRAVADORA DE DVD', 90, 2);


INSERT INTO TB_UF VALUES('PR', 'PARANÁ');
INSERT INTO TB_CIDADE VALUES(1, 'PR', 'NOVA CANTU');
INSERT INTO TB_CIDADE VALUES(2, 'PR', 'CAMPO MOURÃO');
INSERT INTO TB_CIDADE VALUES(3, 'PR', 'MARINGÁ');

INSERT INTO TB_UF VALUES('SP', 'SÃO PAULO');
INSERT INTO TB_CIDADE VALUES(7, 'SP', 'CAIABU');
INSERT INTO TB_CIDADE VALUES(8, 'SP', 'ARANDU');
INSERT INTO TB_CIDADE VALUES(9, 'SP', 'ARARAS');

INSERT INTO TB_UF VALUES('SC', 'SANTA CATARINA');
INSERT INTO TB_CIDADE VALUES(4, 'SC', 'BRUSQUE');
INSERT INTO TB_CIDADE VALUES(5, 'SC', 'BLUMENAU');
INSERT INTO TB_CIDADE VALUES(6, 'SC', 'JOINVILE');


INSERT INTO TB_PESSOA VALUES(1, 'EDVALDO SZYMONEK', 'A');
INSERT INTO TB_ENDERECO VALUES(1, 1, 1, 'CORREGO ARRUDA', 'RUA ARAUCÁRIA, 44');

INSERT INTO TB_PESSOA VALUES(2, 'RAUL ADRIANO RAMOS', 'A');
INSERT INTO TB_ENDERECO VALUES(4, 2, 2, 'JARDIM DAS FLORES', 'AV. SANTOS DUMONT, 23');

INSERT INTO TB_PESSOA VALUES(6, 'LUIZ GERALDO DE OLIVEIRA', 'A');
INSERT INTO TB_ENDERECO VALUES(2, 6, 1, 'CENTRO', 'RUA PROJETADA A, 400');
INSERT INTO TB_ENDERECO VALUES(3, 6, 1, 'CENTRO', 'RUA BAHIA, 342');

INSERT INTO TB_PAGAMENTO VALUES(1, 'PARCELADA', 3, 'S');
INSERT INTO TB_PEDIDO VALUES(1, 3, 6, 1, '17.02.2014', 68);
INSERT INTO TB_PEDIDO_PRODUTO VALUES(1, 3, 6, 1, 2, 34);

INSERT INTO TB_PAGAMENTO VALUES(2, 'A VISTA', 1, 'S');
INSERT INTO TB_PEDIDO VALUES(1, 4, 2, 2, '17.02.2014', 118);
INSERT INTO TB_PEDIDO_PRODUTO VALUES(1, 4, 2, 1, 2, 34);
INSERT INTO TB_PEDIDO_PRODUTO VALUES(1, 4, 2, 3, 1, 50);
